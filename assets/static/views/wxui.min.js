window.wxui||(window.wxui={});(webix.env.isIE||webix.env.isIE8)&&webix.message({type:"error",text:tr("global","The kernel of the browser you are using is IE, in order to better use the system functions, it is recommended that you use a browser such as chrome or Firefox.")});!webix.env.touch&&webix.ui.scrollSize&&webix.CustomScroll.init();
webix.editors.$popup={text:{view:"popup",width:320,height:240,body:{view:"textarea"}},color:{view:"popup",body:{view:"colorboard",width:500,height:500,rows:50,cols:50}},date:{view:"popup",body:{view:"calendar",weekNumber:!0}}};webix.attachEvent("onAjaxError",function(a){let b=/.*?message=(.*),\sinternal.*/.exec(a.responseText);b?webix.message({type:"error",text:b[1],expire:5E3}):webix.message({type:"error",text:a.responseText,expire:5E3})});
webix.attachEvent("onLoadError",function(a,b){console.log(a.responseText);console.log(b.config)});tr=function(a,b){if(window.GlobalTrans&&window.GlobalTrans[a]&&window.GlobalTrans[a][b])return window.GlobalTrans[a][b];webix.ajax().post("/admin/translate/patch",{module:a,key:b,value:b}).then(function(c){console.log(c.msg)});return b};wxui.tr=tr;gtr=function(a){return tr("global",a)};wxui.removeFromArray=function(a,b){for(var c=0;c<a.length;c++)a[c]===b&&a.splice(c,1)};wxui.metricsColors="#f44336 #9c27b0 #3f51b5 #0288d1 #009688 #558b2f #ffa000 #ff5722 #795548 #546e7a #e91e63 #1e88e5".split(" ");
wxui.getPageToolbar=function(a){return{id:a.winid||webix.uid().toString(),view:"toolbar",paddingX:10,css:"page-toolbar",hidden:a.hidden||!1,cols:[{view:"label",label:" <i class='mdi mdi-"+a.icon+"'></i> "+a.title,css:"dash-title-b",width:240,align:"left"},{},{cols:a.elements}]}};wxui.getIconButton=function(a,b,c,d,e){return{view:"button",type:"icon",css:"webix_transparent",inputWidth:b,width:b,icon:"mdi mdi-"+c,label:a,hidden:d,click:e}};
wxui.getIconButton2=function(a,b,c,d,e,f){return{view:"button",type:"icon",css:"webix_transparent",inputWidth:b,width:b,height:c,icon:"mdi mdi-"+d,label:a,hidden:e,click:f}};wxui.getPrimaryButton=function(a,b,c,d){return{view:"button",css:"webix_primary webix_button",inputWidth:b,width:b,label:a,hidden:c,click:d}};wxui.getDangerButton=function(a,b,c,d){return{view:"button",css:"webix_danger",inputWidth:b,width:b,label:a,hidden:c,click:d}};
wxui.getTableCheckedIds=function(a){let b=[];$$(a).eachRow(function(c){(c=$$(a).getItem(c))&&1===c.state&&b.push(c.id)});return b};wxui.getTableCheckedItems=function(a){let b=[];$$(a).eachRow(function(c){(c=$$(a).getItem(c))&&1===c.state&&b.push(c)});return b};wxui.getTableCheckedAttrs=function(a,b){let c=[];$$(a).eachRow(function(d){(d=$$(a).getItem(d))&&1===d.state&&c.push(d[b])});return c};
wxui.getTableChecked_Ids=function(a){let b=[];$$(a).eachRow(function(c){(c=$$(a).getItem(c))&&1===c.state&&b.push(c._id)});return b};
wxui.getTableQueryStdForm=function(a,b){return{id:a,css:"main-panel-box",view:"form",hidden:!1,paddingX:0,paddingY:0,elementsConfig:{labelWidth:60},elements:[{cols:[{view:"multicombo",name:"tags",label:"",value:"",labelWidth:0,placeholder:tr("global","Tags match"),options:"/bss/tag/options",maxWidth:320},{view:"text",name:"keyword",label:"",labelWidth:0,placeholder:tr("global","Keyword match"),maxWidth:320},{cols:[{view:"button",css:"webix_transparent",label:tr("global","Query"),type:"icon",icon:"mdi mdi-search-web",
borderless:!0,width:66,click:function(){b()}},{view:"button",css:"webix_transparent",label:tr("global","Reset"),type:"icon",icon:"mdi mdi-refresh",borderless:!0,width:66,click:function(){$$(a).setValues({keyword:"",tags:""})}}]},{}]}]}};
wxui.getTableQueryKeywordForm=function(a,b){return{id:a,css:"main-panel-box",view:"form",hidden:!1,paddingX:0,paddingY:0,elementsConfig:{labelWidth:60},elements:[{cols:[{view:"text",name:"keyword",label:"",labelWidth:0,placeholder:tr("global","Keyword match"),maxWidth:320},{cols:[{view:"button",css:"webix_transparent",label:tr("global","Query"),type:"icon",icon:"mdi mdi-search-web",borderless:!0,width:66,click:function(){b()}},{view:"button",css:"webix_transparent",label:tr("global","Reset"),type:"icon",
icon:"mdi mdi-refresh",borderless:!0,width:66,click:function(){$$(a).setValues({keyword:""})}}]},{}]}]}};
wxui.getTableQueryKeyDateRangeForm=function(a,b){return{id:a,css:"main-panel-box",view:"form",hidden:!1,paddingX:10,paddingY:0,elementsConfig:{labelWidth:60},elements:[{cols:[{view:"daterangepicker",name:"date_range",label:tr("global","Date range"),format:"%Y-%m-%d",width:300,labelWidth:80,value:{start:webix.Date.add(new Date,-1,"day"),end:new Date}},{view:"text",name:"keyword",label:"",labelWidth:0,placeholder:tr("global","Keyword match"),maxWidth:240},{cols:[{view:"button",css:"webix_transparent",
label:tr("global","Query"),type:"icon",icon:"mdi mdi-search-web",borderless:!0,width:66,click:function(){b()}},{view:"button",css:"webix_transparent",label:tr("global","Reset"),type:"icon",icon:"mdi mdi-refresh",borderless:!0,width:66,click:function(){$$(a).setValues({keyword:""})}}]},{}]}]}};wxui.getTableQueryCustomForm=function(a,b){return{id:a,css:"main-panel-box",view:"form",hidden:!1,paddingX:7,paddingY:0,elementsConfig:{labelWidth:60},elements:b}};
wxui.reloadDataFunc=function(a,b,c){b||(b=$$(a).config.url);return c?function(){$$(a).refresh();$$(a).clearAll();let d=$$(c).getValues(),e=[];for(let f in d){let g=d[f];g instanceof Object?e.push(f+"="+webix.stringify(g)):e.push(f+"="+g)}$$(a).load(b+"?"+e.join("&"))}:function(){$$(a).clearAll();$$(a).load(b)}};
wxui.getDatatable=function(a){let b={id:a.tableid,css:"main-panel-box",view:"datatable",type:a.type||{},headermenu:!0,select:!0,resizeColumn:!0,autoWidth:!0,autoHeight:!0,on:a.on||{},onClick:a.onClick||{}};void 0!==a.leftSplit&&(b.leftSplit=a.leftSplit);void 0!==a.datafetch&&(b.datafetch=a.datafetch);void 0!==a.subrow&&(b.subrow=a.subrow);void 0!==a.subview&&(b.subview=a.subview);void 0!==a.loadahead&&(b.loadahead=a.loadahead);void 0!==a.fixedRowHeight&&(b.fixedRowHeight=a.fixedRowHeight);void 0!==
a.rowLineHeight&&(b.rowLineHeight=a.rowLineHeight);void 0!==a.scrollX&&(b.scrollX=a.scrollX);void 0!==a.editable?(b.editable=a.editable,b.editaction="dblclick"):b.editable=!1;void 0!==a.rightSplit&&(b.rightSplit=a.rightSplit);a.autoConfig?b.autoConfig=a.autoConfig:b.columns=a.columns;a.pager&&(b.pager=a.tableid+".dataPager");a.url&&(b.url=a.url);a.save&&(b.save=a.save);a.data&&(b.data=a.data);b.on.onBeforeLoad=function(){this.showOverlay("lodding...")};b.on.onAfterLoad=function(){this.count()?this.hideOverlay():
this.showOverlay(tr("global","No data loaded"))};return b};
wxui.getTreetable=function(a){let b={id:a.tableid,css:"main-panel-box",view:"treetable",type:a.type||{},headermenu:!0,select:!0,resizeColumn:!0,autoWidth:!0,autoHeight:!0,on:a.on||{},onClick:a.onClick};a.autoConfig?b.autoConfig=a.autoConfig:b.columns=a.columns;a.pager&&(b.pager=a.tableid+".dataPager");a.url&&(b.url=a.url);a.data&&(b.data=a.data);b.on.onBeforeLoad=function(){this.showOverlay(tr("global","loading..."))};b.on.onAfterLoad=function(){this.count()?this.hideOverlay():this.showOverlay(tr("global",
"No data loaded"))};return b};
wxui.getCurdDatatable=function(a){let b=a.tableid||webix.uid(),c={id:b,view:"datatable",borderless:!0,columns:a.columns,editable:!0,select:!0};a.query&&(c.url=a.query);a.save&&(c.save=a.save);let d=[{view:"button",css:"webix_transparent",type:"icon",icon:"mdi mdi-refresh",label:tr("global","Refresh"),width:70,height:36,click:function(){$$(b).editStop();$$(b).clearAll();$$(b).load(a.query)}},{view:"button",css:"webix_transparent",type:"icon",icon:"mdi mdi-plus",label:tr("global","Create"),width:70,
height:36,click:function(){$$(b).add(a.inititem||{})}},{view:"button",css:"webix_transparent",type:"icon",icon:"mdi mdi-delete",label:tr("global","Delete"),width:70,height:36,click:function(){$$(b).editStop();let e=$$(b).getSelectedId();$$(b).remove(e)}},{}];if(a.actions)for(let e in a.actions)d.push(a.actions[e]);a.savefunc&&d.push({view:"button",css:"webix_transparent",type:"icon",icon:"mdi mdi-refresh",label:tr("global","Save"),width:70,height:36,click:function(){let e=[];$$(b).eachRow(function(f){f=
$$(b).getItem(f);e.push(f)});a.savefunc(e)}});return{view:"form",scroll:!0,paddingX:5,paddingY:5,elementsConfig:{labelPosition:"left"},elements:[{cols:d},{cols:[c]}]}};
wxui.getTablePagerBar=function(a,b){return{paddingY:3,cols:[{view:"richselect",name:"page_num",label:tr("global","Pagesize"),value:20,width:140,labelWidth:45,options:[{id:20,value:"20"},{id:50,value:"50"},{id:100,value:"100"},{id:500,value:"500"},{id:1E3,value:"1000"},{id:5E3,value:"5000"}],on:{onChange:function(c,d){$$(a+".dataPager").define("size",parseInt(c));$$(a+".dataPager").refresh();b&&b()}}},{id:a+".dataPager",view:"pager",master:!1,size:20,group:5,template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total:#count#"},
{}]}};
wxui.openFormWindow=function(a){let b=a.winid||webix.uid();if(!$$(b)){var c=b+"_form";return webix.ui({id:b,view:"window",css:"win-body",move:!0,resize:!0,modal:!0,width:a.width||480,height:a.height||640,fullscreen:a.fullscreen||!1,position:"center",head:{view:"toolbar",css:"win-toolbar",cols:[{view:"icon",icon:"mdi mdi-laptop",css:"alter"},{view:"label",label:a.title},{view:"icon",icon:"mdi mdi-fullscreen-exit",css:"alter",click:function(){webix.fullscreen.exit()}},{view:"icon",icon:"mdi mdi-fullscreen",css:"alter",
click:function(){webix.fullscreen.set($$(b))}},{view:"icon",icon:"mdi mdi-close",css:"alter",click:function(){webix.fullscreen.exit();$$(b).close()}}]},body:{rows:[{id:c,view:"form",scroll:!0,elementsConfig:a.elementsConfig||{labelWidth:120},elements:a.elements,data:a.data||{}},{padding:5,cols:[{},{view:"button",name:"submit",css:"webix_primary",label:tr("global","Save"),width:120,height:36,click:function(){if(!$$(c).validate())return webix.message({type:"error",text:tr("global","Please fill in the valid data."),
expire:1E3}),!1;let d=$$(c).getValues();a.callBefore&&(d=a.callBefore(d));webix.ajax().post(a.post,d).then(function(e){e=e.json();webix.message({type:e.msgtype,text:e.msg,expire:5E3});0===e.code&&($$(b).close(),a.callback&&a.callback())})}},{view:"button",css:"webix_transparent",icon:"mdi mdi-close",width:120,label:tr("global","Cancel"),click:function(){$$(b).close()}}]}]}})}};
wxui.openWindow=function(a){let b=a.winid||webix.uid();if(!$$(b))return webix.ui({id:b,view:"window",css:"win-body",move:!0,resize:!0,fullscreen:a.fullscreen||!1,modal:!0,width:a.width||480,height:a.height||640,position:"center",head:{view:"toolbar",css:"win-toolbar",cols:[{view:"icon",icon:"mdi mdi-laptop",css:"alter"},{view:"label",label:a.title},{view:"icon",icon:"mdi mdi-fullscreen-exit",css:"alter",click:function(){webix.fullscreen.exit()}},{view:"icon",icon:"mdi mdi-fullscreen",css:"alter",
click:function(){webix.fullscreen.set($$(b))}},{view:"icon",icon:"mdi mdi-close",css:"alter",click:function(){webix.fullscreen.exit();a.closeEvent&&a.closeEvent();$$(b).close()}}]},body:a.body})};
wxui.getForm=function(a){webix.uid();let b=a.formid||webix.uid(),c=a.winid||webix.uid();return{id:c,css:"main-panel",padding:10,rows:[{view:"toolbar",css:"page-toolbar",cols:[{view:"icon",icon:"mdi mdi-square-edit-outline"},{view:"label",label:a.title},{},a.actions||{cols:[{view:"button",css:"webix_primary",label:tr("global","Save"),width:120,height:36,click:function(){if(!$$(b).validate())return webix.message({type:"error",text:tr("global","Please fill in the valid data."),expire:1E3}),!1;let d=
$$(b).getValues();webix.ajax().post(a.post,d).then(function(e){e=e.json();webix.message({type:e.msgtype,text:e.msg,expire:5E3});0===e.code&&($$(bss.core.tabsId).removeOption(c),wxui.removeFromArray(bss.core.tabsIds,c),a.parentid&&$$(bss.core.tabsId).setValue(a.parentid),a.callback&&a.callback(e))})}},{view:"icon",icon:"mdi mdi-fullscreen",css:"alter",click:function(){webix.fullscreen.set($$(c))}}]}]},{id:b,view:"form",css:"detail-form",scroll:!0,elementsConfig:a.elementsConfig||{labelWidth:120,bottomPadding:a.bottomPadding||
0},elements:a.elements,data:a.data}]}};
wxui.openSideWindow=function(a){let b=a.winid||webix.uid();$$(b)&&$$(b).isVisible()?$$(b).close():webix.ui({view:"sidemenu",id:b,width:a.width||420,position:"right",body:{rows:[{css:"panel-toolbar",paddingX:10,cols:[{view:"icon",icon:"mdi mdi-information-outline",css:"alter webix_transparent"},{view:"label",label:a.title,css:"dash-title-b",inputWidth:150,align:"left"},{},{view:"icon",icon:"mdi mdi-close",css:"webix_transparent",click:function(){$$(b).close()}}]},{view:"scrollview",body:a.body}]}}).show()};
wxui.initUploadApi=function(a,b,c){webix.ui({id:a,view:"uploader",upload:b,on:{onBeforeFileAdd:function(d){d.formData={};webix.message({type:"info",text:tr("global","Upload..."),expire:3E3})},onFileUpload:function(d){c&&c(d)},onFileUploadError:function(d,e){webix.message({type:"error",text:tr("global","Upload failure"),expire:3E3})},onUploadComplete:function(d){webix.message({type:d.msgtype,text:d.msg,expire:5E3})}},apiOnly:!0})};
wxui.getSegmentedView=function(a){return{rows:[{view:"segmented",id:a.tabsId||webix.uid(),value:a.tabsCid,multiview:!0,animate:!1,align:"left",optionWidth:a.tabsWidth,padding:5,options:a.tabCells},{animate:!1,cells:a.viewCells}]}};
wxui.getPictureSelect=function(a,b,c,d,e){a={name:a,view:"richselect",label:b,labelPosition:"top",options:{view:"datasuggest",template:function(f){return"<img src='"+f.id+"' style='width:90%;background:gray;'>"},body:{template:function(f){return f.value+"<img style='width:95%;background:gray;padding: 0;' src='"+f.id+"'>"},type:{width:136,height:136},xCount:6,scroll:"y",autoheight:!1,height:480,url:e}}};c&&0<c&&(a.width=c);d&&0<d&&(a.height=d);return a};
wxui.requirejs=function(a,b,c){console.log("load admin/"+a+".js");"enabled"===b.dev_mode?webix.require("views/"+a+".min.js?ver="+b.pagever,function(){c()}):webix.require("views/"+a+".min.js",function(){c()})};wxui.showBusyBar=function(a,b,c){$$(a).showProgress({type:"top",delay:b,hide:!0});setTimeout(function(){c()},b)};wxui.getFieldSet=function(a,b){return{view:"fieldset",label:a,body:{rows:b}}};
wxui.getWidgetItem=function(a,b){let c="",d=[];for(let e in b){let f=b[e];f instanceof Object?d.push(e+"="+webix.stringify(f)):d.push(e+"="+f)}0<d.length&&(c="?"+d.join("&"));b={};"metrics.html"===a.type&&(b={view:"template",css:{background:a.bgcolor+"!important"},src:a.src+c,borderless:!0});"xmetrics"===a.type?b={view:"template",css:{background:a.bgcolor+"!important"},src:a.src+c,borderless:!0}:"template"===a.type?b={rows:[{type:"header",template:a.title},{view:"template",css:"widget-template",src:a.src+
c,autoheight:!0}]}:"iframe"===a.type&&(b={rows:[{type:"header",template:a.title},{view:"iframe",css:"widget-iframe",src:a.src+c,autoheight:!0}]});return b};wxui.exportData=function(a,b){webix.ajax().response("blob").get(a,function(c,d){c=document.createElement("a");d=window.URL.createObjectURL(d);c.href=d;c.download=b;c.click()})};wxui.tryCall=function(a,b){try{a()}catch(c){console.log(c),b&&b(c)}};
wxui.rules={isEmail:function(a){return a&&""!==a?/\S+@[^@\s]+\.[^@\s]+$/.test((a||"").toString()):!0},isNumber:function(a){return parseFloat(a)==a},isChecked:function(a){return!!a||"0"===a},isNotEmpty:function(a){return 0===a||a},isMoney:function(a){if(null!=a&&""!==a){if(!/^(([1-9]\d*)|\d)(\.\d{1,2})?$/.test(a))return!1}else return!1;return!0}};
wxui.getTableFooterBar=function(a){return{paddingY:3,cols:[wxui.getIconButton(tr("global",""),35,"refresh",!1,a.callback),{view:"richselect",name:"page_num",label:tr("global","Size"),value:20,width:150,labelWidth:60,options:[{id:20,value:""+(a.size||20)},{id:50,value:"50"},{id:100,value:"100"},{id:500,value:"500"},{id:1E3,value:"1000"},{id:5E3,value:"5000"}],on:{onChange:function(b,c){$$(a.tableid+".dataPager").define("size",parseInt(b));$$(a.tableid+".dataPager").refresh();a.callback&&a.callback()}}},
{id:a.tableid+".dataPager",view:"pager",master:!1,size:a.size||20,group:5,template:"{common.first()} {common.prev()} {common.pages()} {common.next()} {common.last()} total:#count#"},{},{hidden:void 0===a.actions||0===a.actions.length,cols:a.actions||[]}]}};function warpRemark(a){return warpString(a.remark,16)}
wxui.openItemDetail=function(a,b){let c={view:"form",paddingX:20,scroll:"auto",elementsConfig:{marginY:0,labelWidth:120},css:"detail-form",data:a.data,elements:[]};for(let d in a.data)c.elements.push({view:"text",name:d,label:d,readonly:!0});webix.ui({view:"popup",css:"win-body",height:480,width:420,scroll:"auto",body:{rows:[{view:"toolbar",css:"win-toolbar",cols:[{view:"icon",icon:"mdi mdi-laptop",css:"alter"},{view:"label",label:a.title}]},c]}}).show(b,{pos:"right"})};
wxui.confirmCall=function(a,b,c){a?webix.confirm({title:"\u64cd\u4f5c\u786e\u8ba4",ok:"Yes",cancel:"No",text:b||"\u786e\u8ba4\u6b64\u64cd\u4f5c\u5417?",callback:function(d){d&&c()}}):c()};wxui.displayTableMessage=function(a,b,c,d,e){webix.ui({view:"popup",height:c,width:b,scroll:"auto",body:{name:"content",view:"codemirror-editor",mode:e,value:d}}).show(a)};
